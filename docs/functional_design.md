# 艺术字小程序 - 功能设计文档

## 1. 核心目标

为用户提供一个模板化、内容驱动的艺术字创作工具，让用户可以快速发现、使用和分享精美的艺术字设计。

## 2. 主要功能模块

### 2.1. 首页模块 (信息流)
- **功能点**:
    - [ ] 以瀑布流或卡片列表形式展示**热门/推荐**的艺术字模板。
    - [ ] 支持下拉刷新和上拉加载更多。
    - [ ] 每个模板卡片上应清晰展示艺术字效果图。
    - [ ] 点击任意模板，进入**艺术字编辑页**。
    - [ ] 在顶部放置明显的"**输入文字，一键应用所有模板**"入口，引导用户尝试内容驱动的创作方式。

### 2.2. 分类模块
- **功能点**:
    - [ ] 对艺术字模板进行分类，如"可爱风"、"商务风"、"节日限定"、"书法系列"等。
    - [ ] 提供分类标签或列表，用户点击后可筛选查看对应分类下的所有模板。

### 2.3. 艺术字编辑模块
- **功能点**:
    - [ ] **模板加载**: 进入页面时，自动加载用户所选模板的样式和示例文本。
    - [ ] **文本编辑**: 用户可以修改模板中的文字内容。
    - [ ] **样式微调**: 用户可以对模板的现有样式进行微调（如更换颜色、调整阴影等），但主要以模板为基础。
    - [ ] **实时预览**: 所有修改实时在画布上生效。
    - [ ] **导出与保存**: 将最终成品保存为图片到手机相册。

### 2.4. 我的模块
- **功能点**:
    - [ ] **我的作品**: 展示用户所有保存过的艺术字作品。
    - [ ] **我的收藏**: (可选) 用户可以收藏喜欢的模板。
    - [ ] **设置与关于**: 提供应用的设置选项、版本信息和联系方式。

### 2.5. 内容驱动模板选择模块 (新功能)
- **功能点**:
    - [ ] **文本优先输入**: 提供一个明显的文本输入框，让用户先输入想要美化的文字内容。
    - [ ] **多模板预览**: 用户输入文字后，系统自动将该文字应用到多个热门模板上并展示预览效果。
    - [ ] **智能分批加载**: 模板预览采用分批渲染机制，初始只加载6-8个热门模板，用户滚动时再加载更多。
    - [ ] **轻量级预览**: 列表中的预览使用简化效果渲染，减少性能消耗。
    - [ ] **详细预览**: 用户点击或在某个预览上停留时，展示该模板的完整效果渲染。
    - [ ] **分类筛选**: 允许用户在保持当前输入文本的情况下，切换不同分类查看对应模板效果。
    - [ ] **模板选择**: 用户点击喜欢的预览效果后，直接进入艺术字编辑页面，应用该模板和用户的文字。

## 3. 页面结构 (Page Structure)

小程序采用底部标签栏 (Bottom Tab Bar) 导航，包含三个主页面：

- **Tab 1: 首页**
    - **内容**: 热门艺术字模板信息流。
    - **目的**: 吸引用户，快速发现精美设计。

- **Tab 2: 分类**
    - **内容**: 结构化的艺术字模板分类。
    - **目的**: 帮助有明确风格偏好的用户快速查找模板。

- **Tab 3: 我的**
    - **内容**: 个人作品、收藏和设置。
    - **目的**: 提供个性化服务和用户留存。

## 4. 新版用户流程 (User Flow)

1.  **打开小程序**: 用户进入应用，默认显示**首页**，浏览热门艺术字模板。
2.  **发现与选择**:
    - **路径A (首页-模板优先)**: 用户在首页信息流中上下滑动，发现喜欢的模板并点击。
    - **路径B (分类-模板优先)**: 用户切换到**分类**标签页，选择一个分类（如"节日"），然后点击该分类下的一个模板。
    - **路径C (内容优先)**: 用户点击首页顶部的"输入文字"入口，先输入自己的文字，然后在预览列表中选择最适合的模板效果。
3.  **进入编辑页**: 点击模板后，跳转到**艺术字编辑页面**。页面已加载好模板样式。
    - 若用户来自路径A或B，页面显示模板的示例文本，等待用户修改。
    - 若用户来自路径C，页面已预填入用户之前输入的文字。
4.  **个性化创作**:
    - 用户在输入框中替换成自己的文字。
    - (可选) 用户微调颜色、效果等参数。
5.  **生成与保存**:
    - 点击"保存"按钮。
    - 小程序生成高清图片，并请求授权保存到用户手机相册。
    - 保存成功的作品会自动记录在"**我的**" -> "**我的作品**"中。
6.  **回顾作品**: 用户可以随时进入"**我的**"页面，查看自己创作的历史作品。

## 5. "先输入，后选模板"功能实现注意事项

### 5.1. 性能优化策略
- **分批渲染**: 初始只渲染可视区域内的6-8个热门模板，随着用户滚动逐步加载更多。
- **轻量级预览**: 
  - 列表中的预览使用简化渲染（只应用基本样式如字体和主色调，不渲染复杂的阴影、描边和渐变效果）。
  - 只有当用户点击或在某个预览上停留1秒以上时，才展示完整效果渲染。
- **资源管理**:
  - 控制同时加载的字体文件数量，设置优先级队列。
  - 对滚出视图范围的模板主动释放资源，避免内存占用过高。
- **预渲染缓存**:
  - 对相同文字+模板组合的渲染结果进行缓存，避免重复计算。
  - 当用户修改文字时，清除旧的预览缓存并重新渲染。

### 5.2. 技术实现关键点
- 使用 `wx.createOffscreenCanvas` 进行离屏渲染，避免同时操作多个可见 canvas 导致的性能问题。
- 实现智能的字体加载队列，优先加载可见模板所需的字体。
- 为正在加载中的模板显示明确的加载状态，提供良好的用户反馈。
- 针对不同网络环境和设备性能，动态调整同时渲染的模板数量。

### 5.3. 用户体验优化
- 在用户输入文字的同时，实时更新已加载的模板预览，提供即时反馈。
- 为模板预览提供简单的筛选机制，允许用户快速查找特定风格。
- 记住用户最近输入的文字，方便用户在不同场景下快速尝试多种模板。
