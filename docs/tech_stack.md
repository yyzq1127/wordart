# 艺术字小程序 - 技术栈选型文档

## 1. 开发框架

- **框架: `微信小程序原生框架`**
    - **选型理由**:
        - **性能最优**: 直接运行在微信环境中，没有额外的编译和适配层，能提供最佳的性能和最快的加载速度。
        - **原生API全面支持**: 可以无缝、及时地使用微信提供的所有最新API和功能，无需等待第三方框架更新。
        - **稳定可靠**: 作为官方标准，其稳定性和长期维护得到了充分保障。
        - **专注单一平台**: 既然目标明确为微信小程序，使用原生框架可以避免不必要的复杂性，让开发更直接、更专注。

## 2. 图形与Canvas库

- **核心库: `Fabric.js` (适配小程序版)**
    - **选型理由**:
        - **强大的对象模型**: Fabric.js 将 Canvas 中的所有内容（文本、图形、图片）都视为可编程的对象。这使得修改文本内容、字体、颜色、描边、阴影、位置等属性变得极其简单，无需手动操作底层的 Canvas API。
        - **事件处理**: 内置了丰富的事件系统，可以轻松实现元素的拖拽、缩放、旋转等交互。
        - **社区支持**: 社区有成熟的将 Fabric.js 适配到微信小程序环境的方案，可以解决原生小程序Canvas API较为繁琐的问题。

## 3. UI 组件库

- **组件库: `Vant Weapp`**
    - **选型理由**:
        - **社区活跃**: 由有赞团队维护，社区活跃，持续更新，是小程序生态中最流行的组件库之一。
        - **设计优秀**: 组件风格精致，同时遵循微信小程序的设计规范。
        - **组件齐全**: 提供了开发所需的大量高质量组件，如 `Slider`, `Tabs`, `Popup` 等，开箱即用，能显著提升开发效率。

## 4. 状态管理

- **方案: `小程序原生数据响应` + `mobx-miniprogram` (可选)**
    - **选型理由**:
        - **原生方案**: 对于简单页面，直接使用小程序提供的 `setData` 和 `data` 响应式机制即可满足需求，无需引入额外库。
        - **进阶方案**: 当页面逻辑变得复杂，或需要跨页面共享状态时，可以引入 `mobx-miniprogram`。它能提供更清晰、更高效的状态管理模式，且与原生小程序结合得很好。

## 5. 开发工具与环境

- **包管理器**: `npm` 或 `yarn`
- **代码规范**: `ESLint` + `Prettier`
- **开发IDE**: `Visual Studio Code` + `微信开发者工具`

## 6. 核心技术方案：字体处理

针对大量字体文件（单个可能超过5MB）导致的微信小程序包体超限（主包<2MB，总包<20MB）和用户加载缓慢问题，我们采用**云端存储 + 动态加载 + 字体裁剪**的组合方案。

### 6.1. 字体云端托管 (Server Hosting)
- **方案**: 所有 `.ttf` 字体文件均不包含在小程序代码包内，而是上传至云对象存储服务（如 阿里云OSS、腾讯云COS）。
- **优势**: 彻底解决小程序包体大小限制问题，使得理论上可以支持无限数量的字体。

### 6.2. 按需动态加载 (On-Demand Loading)
- **方案**: 当用户在编辑页中**首次点击**某个未加载的字体时，调用 `wx.loadFontFace()` API，传入该字体在云存储上的URL，进行动态下载。
- **优势**:
    - **极致的初始加载速度**: 用户打开小程序时无需下载任何字体文件。
    - **按需下载，节省流量**: 用户只下载他们感兴趣并实际使用的字体。
    - **自动缓存**: 微信会对成功加载的字体进行本地缓存，用户后续使用同一字体时无需再次下载，实现秒速切换。

### 6.3. 字体文件优化 (Font Subsetting)
- **方案**: 在将字体上传到云端前，使用专业工具（如 `font-spider` 或 `pyftsubset`）对字体文件进行**裁剪**。提取常用汉字（如GB2312标准约6700字）生成一个精简版的字体包。
- **优势**: 将单个字体文件从 5MB+ 大小压缩至 **1MB 以下**，极大缩短用户首次选择字体时的下载等待时间。

## 总结

本技术栈选型旨在实现**高效开发**、**良好体验**和**未来可扩展性**的平衡。核心是利用 **Taro** 的跨端能力和 **Fabric.js** 强大的图形处理能力，快速构建出功能完善的艺术字小程序。
